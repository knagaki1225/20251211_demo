<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>top</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/fansite/top.css">
</head>

<body>
    <div class="container">
        <header>
            <div class="logo-placeholder"><img src="../img/象と花実物.png" style="width: 3rem;" alt=""></div>
            <div class="btn-shadow">
                <a href="review-form.html" class=" btn-register btn-color">お問合わせ<span class="contact-text">></span></a>
            </div>
            <div class="menu-icon" id="menuOpen">
                <div class="menu-icon-box">
                    <span class="span-top"></span>
                    <span class="span-middle"></span>
                    <span class="span-bottom"></span>
                </div>
            </div>
        </header>
        <div class="slider-box">
            <div class="slider">
                <div class="slides">
                    <div class="slide active"><img src="..//img/img.png" alt=""></div>
                    <div class="slide"><img src="..//img/img.png" alt=""></div>
                    <div class="slide"><img src="..//img/img.png" alt=""></div>
                </div>

                <div class="dots">
                    <span class="dot active" data-index="0"></span>
                    <span class="dot" data-index="1"></span>
                    <span class="dot" data-index="2"></span>
                </div>
            </div>
        </div>
        <section class="about-section">
            <div class="about-wrapper">
                <h2 class="about-title">象と花ファンサイトについて</h2>
                <p class="about-subtitle">ABOUT US</p>
                <div class="about-line"></div>

                <div class="about-text-box">
                    <p class="about-text">このサイトは</p>
                    <p class="about-text">子供たちがもっと本と出会える環境を</p>
                    <p class="about-text">作ることを目的とした</p>
                    <p class="about-text">象と花プロジェクトのファンサイトです。</p>
                </div>
                <div class="about-text-box">
                    <p class="about-text">あなたに知識や感動を与えてくれた本を</p>
                    <p class="about-text">循環させ、病気とたたかう子供たちの</p>
                    <p class="about-text">ための本に替えて贈ります。</p>
                    <p class="about-text">子供たちと読書のよろこびを分かち合える取り組みです。</p>
                </div>
            </div>
        </section>

        <section class="section-info">
            <div class="section-title-area">
                <h2 class="section-title">最新のお知らせ<span class="section-title-text">infomation</span></h2>
                <div class="seciton-green"></div>
            </div>
            <div class="news-list" id="newsList">
                <a href="" class="news-item">
                    <div class="news-body">
                        <div class="news-meta">
                            <span class="news-date">2025/12/10</span>
                            <span class="news-tag">#企画情報</span>
                        </div>
                        <div class="news-box">
                            <p class="news-title">文庫X2.0の投票がスタート</p>
                            <span class="news-arrow">&gt;</span>
                        </div>
                    </div>
                </a>
                <a href="" class="news-item">
                    <div class="news-body">
                        <div class="news-meta">
                            <span class="news-date">2025/11/30</span>
                            <span class="news-tag">#寄贈情報</span>
                        </div>
                        <div class="news-box">
                            <p class="news-title">〇〇へ寄贈をしました</p>
                            <span class="news-arrow">&gt;</span>
                        </div>
                    </div>
                </a>
                <a href="" class="news-item">
                    <div class="news-body">
                        <div class="news-meta">
                            <span class="news-date">2025/11/20</span>
                            <span class="news-tag">#企画情報</span>
                        </div>
                        <div class="news-box">
                            <p class="news-title">書評投稿を終了しました</p>
                            <span class="news-arrow">&gt;</span>
                        </div>
                    </div>
                </a>
                <a href="" class="news-item">
                    <div class="news-body">
                        <div class="news-meta">
                            <span class="news-date">2025/11/10</span>
                            <span class="news-tag">#その他情報</span>
                        </div>
                        <div class="news-box">
                            <p class="news-title">利用規約を改訂しました</p>
                            <span class="news-arrow">&gt;</span>
                        </div>
                    </div>
                </a>
                <a href="../info/post-list.html" class="btn btn-next-step" id="btn-next-step">
                    お知らせ一覧へ
                </a>
            </div>
        </section>
        <div class="colored-section">
            <div style="background-color: white;">
                <div class="wave-divider wave-top">
                    <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120"
                        preserveAspectRatio="none">
                        <path
                            d="M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47V0Z"
                            opacity=".25" class="shape-fill"></path>
                    </svg>
                </div>
                <div class="wave-divider wave-bottom">
                    <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120"
                        preserveAspectRatio="none">
                        <path
                            d="M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47V0Z"
                            opacity=".25" class="shape-fill"></path>
                    </svg>
                </div>
            </div>
        </div>
        <section style="background-color: white;">
            <div class="section-title-area">
                <h2 class="section-title-project">企画一覧<span class="section-title-text">project</span></h2>
                <div class="seciton-green-project"></div>
            </div>
            <div class="tab-wrapper">
                <div class="tab active">
                    開催中
                    <span class="marker"></span>
                </div>
                <div class="tab">
                    過去の企画
                </div>
            </div>
            <div class="card-box" id="projectCardBox">
                <div class="card">
                    <a href="../plan/first-ex.html">
                        <div class="card-image-wrapper">
                            <div class="badge" style="background-color: #449872;">
                                文庫X2.0
                            </div>
                            <img src="../img/book-giri.png" alt="">
                        </div>
                        <div class="card-content">
                            <div class="date-row">
                                <span class="date-label">開催期間</span>
                                <span>2025.12.01 - 2025.12.31</span>
                            </div>
                            <p class="description">
                                2025年を締めくくる大型企画。今年読んだ本の中からベストな一冊を選んでください。
                            </p>
                        </div>
                    </a>
                </div>
                <div class="card">
                    <a href="../plan/first-ex.html">
                        <div class="card-image-wrapper">
                            <div class="badge" style="background-color: #449872;">
                                文庫X2.0
                            </div>
                            <img src="../img/book-giri.png" alt="">
                        </div>
                        <div class="card-content">
                            <div class="date-row">
                                <span class="date-label">開催期間</span>
                                <span>2025.12.01 - 2025.12.31</span>
                            </div>
                            <p class="description">
                                2025年を締めくくる大型企画。今年読んだ本の中からベストな一冊を選んでください。
                            </p>
                        </div>
                    </a>
                </div>
            </div>

            <div>
                <a href="" class="btn btn-next-step" id="btn-next-step">
                    企画一覧へ
                </a>
            </div>
        </section>
        <div class="colored-section">
            <div style="background-color: white;">
                <div class="wave-divider wave-top">
                    <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120"
                        preserveAspectRatio="none">
                        <path
                            d="M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47V0Z"
                            opacity=".25" class="shape-fill"></path>
                    </svg>
                </div>

            </div>
        </div>
        <div class="contact-box">
            <div class="contact-card">
                <h2 class="contact-title">お問い合わせ</h2>
                <div class="contact-desc-box">
                    <p class="contact-desc">企画、寄贈に関するご質問など、</p>
                    <p class="contact-desc">お気軽にお問い合わせください。</p>
                </div>
                <a href="#" class="contact-btn">
                    <span class="btn-text">お問い合わせフォーム</span>
                    <span class="btn-arrow">&gt;</span>
                </a>

                <div class="tel-box">
                    <div class="tel-main">
                        <span class="tel-label">TEL</span>
                        <span class="tel-number">000-0000-0000</span>
                    </div>
                    <p class="tel-hours">受付時間 ｜ 平日 9:00 ~ 17:00</p>
                </div>
            </div>
        </div>
    </div>



    <footer class="footer-all">
        <div class="footer-menu">
            <div class="footer-top">
                <img src="../img/象と花-白.png" style="width: 4.5rem;" alt="">
                <p class="footer-white-text">A BOOK PROJECT</p>
            </div>
            <a href="#" class="footer-menu-item-top">
                <p>お知らせ</p>
                <p>></p>
            </a>
            <a href="#" class="footer-menu-item">
                <p>企画</p>
                <p>></p>
            </a>
            <a href="#" class="footer-menu-item">
                <p>象と花プロジェクト</p>
                <p>></p>
            </a>
            <a href="#" class="footer-menu-item">
                <p>お問い合わせ</p>
                <p>></p>
            </a>
            <a href="#" class="footer-menu-item">
                <p>サイトのご利用について</p>
                <p>></p>
            </a>
        </div>


        <div class="footer-sns">
            <div class="sns-box">
                <div class="footer-sns-title">SNS</div>
                <div class="sns-box-icons">
                    <div class="sns-icons">
                        <img src="../img/instagram.png" class="sns-icon" alt="">
                        <img src="../img/facebook.png" class="sns-icon-facebook" alt="">
                        <img src="../img/x.png" class="sns-icon-x" alt="">
                    </div>

                    <div class="sns-labels">
                        <span>Instagram</span>
                        <span>Facebook</span>
                        <span>X（旧Twitter）</span>
                    </div>
                </div>
            </div>
            <div class="footer-line"></div>

            <div class="footer-copy">©Copylight</div>
        </div>
    </footer>


    <div class="overlay-menu" id="overlayMenu">
        <div class="close-btn" id="menuClose">×</div>

        <ul class="menu-list">
            <li class="menu-item">企画情報</li>
            <div class="menu-separator"></div>

            <li class="menu-item">寄贈情報</li>
            <div class="menu-separator"></div>

            <li class="menu-item">その他情報</li>
            <div class="menu-separator"></div>

            <li class="menu-item">企画一覧</li>
            <div class="menu-separator"></div>

            <a href="../auth/login.html" class="menu-item">ログイン</a>
        </ul>
    </div>
    </div>

    <script>
        // ▼▼▼ 要素を取得 ▼▼▼
        const menuOpen = document.getElementById('menuOpen');   // ハンバーガーメニューのアイコン
        const menuClose = document.getElementById('menuClose'); // ハンバーガーメニューの閉じるボタン
        const overlayMenu = document.getElementById('overlayMenu'); // ハンバーガーメニュー本体

        // ★★★ 追加: お知らせと企画の表示エリアの要素を取得 ★★★
        const newsList = document.getElementById('newsList');
        const projectCardBox = document.getElementById('projectCardBox');

        // ▼▼▼ ハンバーガーメニューの動作（既存のまま） ▼▼▼
        menuOpen.addEventListener('click', () => {
            overlayMenu.classList.add('active');
        });

        menuClose.addEventListener('click', () => {
            overlayMenu.classList.remove('active');
        });
    </script>
    <script>
        // imgの切り替え処理
        let currentIndex = 0;
        const slides = document.querySelectorAll('.slide');
        const dots = document.querySelectorAll('.dot');
        const slidesWrapper = document.querySelector('.slides');

        function showSlide(index) {
            currentIndex = index;
            slidesWrapper.style.transform = `translateX(-${index * 100}%)`;

            dots.forEach(dot => dot.classList.remove('active'));
            dots[index].classList.add('active');
        }

        // ドットを押した時
        dots.forEach(dot => {
            dot.addEventListener('click', () => {
                showSlide(Number(dot.dataset.index));
            });
        });

        // 自動スライド
        setInterval(() => {
            let next = (currentIndex + 1) % slides.length;
            showSlide(next);
        }, 5000);  // 10秒ごとに切り替え
    </script>
    <script>
        // 企画一覧のタブメニュー
        const tabs = document.querySelectorAll('.tab');

        tabs.forEach(tab => {
            tab.addEventListener('click', function () {
                // 全てのタブからactiveクラスとmarkerを削除
                tabs.forEach(t => {
                    t.classList.remove('active');
                    const marker = t.querySelector('.marker');
                    if (marker) marker.remove();
                });

                // クリックされたタブにactiveクラスを追加
                this.classList.add('active');

                // マーカーを追加
                const marker = document.createElement('span');
                marker.classList.add('marker');
                this.appendChild(marker);
            });
        });
    </script>

    <script>
        const API_URL = 'http://localhost:8080/api/fansite';

        /**
         * 日付文字列を YYYY.MM.DD 形式に整形する
         * @param {string} dateString - ISO 8601形式の日付文字列
         * @returns {string} - YYYY.MM.DD形式の文字列
         */
        function formatDate(dateString) {
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}.${month}.${day}`;
        }

        /**
         * カテゴリーのキーを日本語のタグ名に変換する
         * @param {string} categoryKey - カテゴリーのキー (e.g., "PROJECT")
         * @returns {string} - 日本語のタグ名 (e.g., "#企画情報")
         */
        function getCategoryTag(categoryKey) {
            switch (categoryKey) {
                case 'PROJECT':
                    return '#企画情報';
                case 'DONATION':
                    return '#寄贈情報';
                case 'ELSE':
                    return '#その他情報';
                default:
                    return '#お知らせ';
            }
        }

        /**
         * お知らせリストをレンダリングする
         * @param {Array<Object>} posts - お知らせデータの配列
         */
        function renderNews(posts) {
            if (!newsList || !posts || posts.length === 0) return;

            // 既存の内容をクリア
            newsList.innerHTML = '';

            posts.forEach(post => {
                // postsのidは、詳細ページへのリンクに使用する想定
                const postLink = `../info/post-detail.html?id=${post.id}`;
                const formattedDate = formatDate(post.postedAt);
                const categoryTag = getCategoryTag(post.category);

                const newsItem = document.createElement('a');
                newsItem.href = postLink;
                newsItem.classList.add('news-item');

                // ニュースアイテムのHTML構造を作成
                newsItem.innerHTML = `
                    <div class="news-body">
                        <div class="news-meta">
                            <span class="news-date">${formattedDate}</span>
                            <span class="news-tag">${categoryTag}</span>
                        </div>
                        <div class="news-box">
                            <p class="news-title">${post.title}</p>
                            <span class="news-arrow">&gt;</span>
                        </div>
                    </div>
                `;

                newsList.appendChild(newsItem);
            });
        }

        /**
         * 企画カードをレンダリングする
         * @param {Array<Object>} projects - 企画データの配列
         */
        function renderProjects(projects) {
            if (!projectCardBox || !projects || projects.length === 0) return;

            // 既存の内容をクリアca
            projectCardBox.innerHTML = '';

            projects.forEach(project => {
                // projectのurlKeyやidは、詳細ページへのリンクに使用する想定
                const projectLink = `../plan-list.html#${project.urlKey || project.id}`;
                const formattedStart = formatDate(project.projectStartAt);
                const formattedEnd = formatDate(project.projectEndAt);

                // mainImgUrlがnullまたは空の場合は、デフォルト画像を使用（ここではimg.pngを想定）
                const imageUrl = project.mainImgUrl || '../img/img.png';

                const projectCard = document.createElement('div');
                projectCard.classList.add('card');

                // カードのHTML構造を作成
                // <a href="${projectLink}" class="card-link">
                projectCard.innerHTML = `
                        <a href="../plan/first-ex.html" class="card-link">
                        <div class="card-image-wrapper">
                            <div class="badge" style="background-color: ${project.themeColor || '#449872'};">${project.name}</div>
                            <img src="http://localhost:8080/api/image/${imageUrl}" alt="${project.name}">
                        </div>
                        <div class="card-content">
                            <div class="date-row">
                                <span class="date-label">開催期間</span>
                                <span>${formattedStart} - ${formattedEnd}</span>
                            </div>
                            <p class="description">
                                ${project.introduction}
                            </p>
                        </div>
                    </a>
                `;

                projectCardBox.appendChild(projectCard);
            });
        }

        /**
         * APIからデータを取得し、各セクションにレンダリングする
         */
        async function fetchDataAndRender() {
            try {
                const response = await fetch(API_URL, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                // お知らせをレンダリング
                renderNews(data.posts);

                // 企画をレンダリング
                renderProjects(data.projects);

            } catch (error) {
                console.error('データの取得に失敗しました:', error);
                // エラー発生時は、表示エリアにエラーメッセージを表示するなどの対応も可能
                // newsList.innerHTML = '<p>お知らせの読み込みに失敗しました。</p>';
                // projectCardBox.innerHTML = '<p>企画情報の読み込みに失敗しました。</p>';
            }
        }

        // ページロード時にデータ取得とレンダリングを実行
        document.addEventListener('DOMContentLoaded', fetchDataAndRender);

    </script>

</body>

</html>